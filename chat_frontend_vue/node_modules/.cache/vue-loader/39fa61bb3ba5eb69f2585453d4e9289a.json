{"remainingRequest":"E:\\Study\\杉达\\Jee项目实践\\大作业\\project\\chat_frontend_vue\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!E:\\Study\\杉达\\Jee项目实践\\大作业\\project\\chat_frontend_vue\\src\\components\\GroupChat.vue?vue&type=script&lang=js&","dependencies":[{"path":"E:\\Study\\杉达\\Jee项目实践\\大作业\\project\\chat_frontend_vue\\src\\components\\GroupChat.vue","mtime":1593582478212},{"path":"E:\\Study\\杉达\\Jee项目实践\\大作业\\project\\chat_frontend_vue\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"E:\\Study\\杉达\\Jee项目实践\\大作业\\project\\chat_frontend_vue\\node_modules\\babel-loader\\lib\\index.js","mtime":499162500000},{"path":"E:\\Study\\杉达\\Jee项目实践\\大作业\\project\\chat_frontend_vue\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"E:\\Study\\杉达\\Jee项目实践\\大作业\\project\\chat_frontend_vue\\node_modules\\vue-loader\\lib\\index.js","mtime":499162500000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:Ly8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KCmltcG9ydCByb3V0ZXIgZnJvbSAiLi4vcm91dGVyIjsKCmV4cG9ydCBkZWZhdWx0IHsKICAgIG5hbWU6ICJHcm91cENoYXQiLAogICAgZGF0YSgpIHsKICAgICAgICByZXR1cm4gewogICAgICAgICAgICBtc2dVc2VySWQ6IG51bGwsCiAgICAgICAgICAgIGNoYXRNc2c6IG51bGwsCiAgICAgICAgfQogICAgfSwKICAgIG1vdW50ZWQoKSB7CiAgICAgICAgLy8g5Yid5aeL5YyWd2Vic29ja2V0CiAgICAgICAgaWYgKHR5cGVvZiAoV2ViU29ja2V0KSA9PT0gInVuZGVmaW5lZCIpIHsKICAgICAgICAgICAgYWxlcnQoIuaCqOeahOa1j+iniOWZqOS4jeaUr+aMgVdlYlNvY2tldCEiKQogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIHRoaXMuc29ja2V0ID0gbmV3IFdlYlNvY2tldCgnd3M6Ly8xMjcuMC4wLjE6ODA4OC93cycpCiAgICAgICAgICAgIHRoaXMuc29ja2V0Lm9ub3BlbiA9IHRoaXMub3BlbgogICAgICAgICAgICB0aGlzLnNvY2tldC5vbmVycm9yID0gdGhpcy5lcnJvcgogICAgICAgICAgICB0aGlzLnNvY2tldC5vbm1lc3NhZ2UgPSB0aGlzLmdldE1lc3NhZ2UKICAgICAgICB9CiAgICB9LAogICAgbWV0aG9kczogewogICAgICAgIC8vIOWumuS5iXdlYnNvY2tldOWfuuehgOaWueazlQogICAgICAgIG9wZW4oKSB7CiAgICAgICAgICAgIGNvbnNvbGUubG9nKCJTb2NrZXQgY29ubmVjdGVkIik7CiAgICAgICAgICAgIHRoaXMuaW5pdCgpOwogICAgICAgIH0sCiAgICAgICAgZXJyb3IoKSB7CiAgICAgICAgICAgIGNvbnNvbGUubG9nKCJTb2NrZXQgZXJyb3IiKQogICAgICAgIH0sCiAgICAgICAgc2VuZChyZXF1ZXN0KSB7CiAgICAgICAgICAgIHRoaXMuc29ja2V0LnNlbmQoSlNPTi5zdHJpbmdpZnkocmVxdWVzdCkpOwogICAgICAgIH0sCgogICAgICAgIGdldE1lc3NhZ2UocmVzcG9uc2UpIHsKICAgICAgICAgICAgbGV0IGRhdGEgPSBKU09OLnBhcnNlKHJlc3BvbnNlLmRhdGEpOwogICAgICAgICAgICBjb25zb2xlLmxvZyhkYXRhKTsKICAgICAgICAgICAgLy8g6IGK5aSp5raI5oGvCiAgICAgICAgICAgIGlmIChkYXRhLmFjdGlvbiA9PT0gMTApIHsKICAgICAgICAgICAgICAgIGxldCBkYXRlID0gbmV3IERhdGUoKTsKICAgICAgICAgICAgICAgIGRhdGEuY2hhdE1zZy50aW1lID0gZGF0ZS50b0xvY2FsZVN0cmluZygnY2hpbmVzZScsIHtob3VyMTI6IGZhbHNlfSk7CiAgICAgICAgICAgICAgICB0aGlzLiRzdG9yZS5jb21taXQoInB1c2hSZWNNc2ciLCBkYXRhLmNoYXRNc2cpOwogICAgICAgICAgICAgICAgaWYgKHRoaXMuJHN0b3JlLnN0YXRlLnF1ZXJ5UmVzdWx0LmlkICE9PSBkYXRhLmlkKSB7CiAgICAgICAgICAgICAgICAgICAgY29uc29sZS5sb2coKTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIHRoaXMuc2Nyb2xsKCk7CiAgICAgICAgICAgICAgICB0aGlzLm1zZ1VzZXJJZCA9IGRhdGEuY2hhdE1zZy5zZW5kZXJJZDsKICAgICAgICAgICAgfQogICAgICAgICAgICAvLyDlpb3lj4vnlLPor7cKICAgICAgICAgICAgaWYgKGRhdGEuYWN0aW9uID09PSA5KSB7CiAgICAgICAgICAgICAgICB0aGlzLm1zZ1VzZXJJZCA9ICdyZXF1ZXN0JwogICAgICAgICAgICB9CiAgICAgICAgICAgIC8vIOWlveWPi+eUs+ivt+mAmui/hwogICAgICAgICAgICBpZiAoZGF0YS5hY3Rpb24gPT09IDUpIHsKICAgICAgICAgICAgICAgIHRoaXMuYXhpb3MuZ2V0KCIvdXNlci9mcmllbmQiKS50aGVuKHJlc3BvbnNlID0+IHsKICAgICAgICAgICAgICAgICAgICB0aGlzLiRzdG9yZS5jb21taXQoJ3NldEZyaWVuZExpc3QnLCByZXNwb25zZS5kYXRhKTsKICAgICAgICAgICAgICAgIH0pLmNhdGNoKChlcnJvcikgPT4gewogICAgICAgICAgICAgICAgICAgIGlmIChlcnJvci5yZXNwb25zZS5zdGF0dXMgPT09IDQwMSkgewogICAgICAgICAgICAgICAgICAgICAgICByb3V0ZXIucmVwbGFjZSgiL3dlbGNvbWUiKQogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICB9CiAgICAgICAgfSwKICAgICAgICBjbG9zZSgpIHsKICAgICAgICAgICAgY29uc29sZS5sb2coIlNvY2tldCBjbG9zZWQiKQogICAgICAgIH0sCiAgICAgICAgLy8g5Yid5aeL5YyWCiAgICAgICAgaW5pdCgpIHsKICAgICAgICAgICAgbGV0IGluaXRSZXEgPSB7CiAgICAgICAgICAgICAgICAiYWN0aW9uIjogMSwKICAgICAgICAgICAgICAgICJjaGF0TXNnIjogewogICAgICAgICAgICAgICAgICAgICJzZW5kZXJJZCI6IHRoaXMuJHN0b3JlLnN0YXRlLmN1cnJlbnRVc2VyLmlkCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH07CiAgICAgICAgICAgIGluaXRSZXEuY2hhdE1zZy5zZW5kZXJJZCA9IHRoaXMuJHN0b3JlLnN0YXRlLmN1cnJlbnRVc2VyLmlkOwogICAgICAgICAgICB0aGlzLnNlbmQoaW5pdFJlcSkKICAgICAgICB9LAogICAgICAgIC8vIOWPkemAgea2iOaBrwogICAgICAgIHNlbmRNc2cobXNnKSB7CiAgICAgICAgICAgIG1zZyA9IG1zZy5yZXBsYWNlKCdcbicsICcnKTsKICAgICAgICAgICAgaWYgKCFtc2cpIHsKICAgICAgICAgICAgICAgIHRoaXMuY2hhdE1zZyA9IG51bGw7CiAgICAgICAgICAgICAgICBhbGVydCgi5Y+R6YCB5YaF5a655LiN6IO95Li656m677yM6K+36YeN5paw6L6T5YWlIikKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIGxldCBjaGF0UmVxID0gewogICAgICAgICAgICAgICAgICAgIGFjdGlvbjogMTAsCiAgICAgICAgICAgICAgICAgICAgY2hhdE1zZzogewogICAgICAgICAgICAgICAgICAgICAgICBzZW5kZXJJZDogbnVsbCwKICAgICAgICAgICAgICAgICAgICAgICAgZ3JvdXBJZDogbnVsbCwKICAgICAgICAgICAgICAgICAgICAgICAgbmFtZTogbnVsbCwKICAgICAgICAgICAgICAgICAgICAgICAgbXNnOiBudWxsCiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfTsKICAgICAgICAgICAgICAgIGNoYXRSZXEuY2hhdE1zZy5zZW5kZXJJZCA9IHRoaXMuJHN0b3JlLnN0YXRlLmN1cnJlbnRVc2VyLmlkOwogICAgICAgICAgICAgICAgY2hhdFJlcS5jaGF0TXNnLm5hbWUgPSB0aGlzLiRzdG9yZS5zdGF0ZS5jdXJyZW50VXNlci5uYW1lOwogICAgICAgICAgICAgICAgY2hhdFJlcS5jaGF0TXNnLmdyb3VwSWQgPSB0aGlzLiRzdG9yZS5zdGF0ZS5xdWVyeVJlc3VsdC5pZDsKICAgICAgICAgICAgICAgIGNoYXRSZXEuY2hhdE1zZy5tc2cgPSBtc2cucmVwbGFjZSgnXG4nLCAnJyk7CiAgICAgICAgICAgICAgICB0aGlzLnNlbmQoY2hhdFJlcSk7CiAgICAgICAgICAgICAgICB0aGlzLmNoYXRNc2cgPSBudWxsOwogICAgICAgICAgICAgICAgdGhpcy5zY3JvbGwoKQogICAgICAgICAgICB9CiAgICAgICAgfSwKICAgICAgICBzY3JvbGwoKSB7CiAgICAgICAgICAgIHRoaXMuJG5leHRUaWNrKCgpID0+IHsKICAgICAgICAgICAgICAgIGxldCBtc2cgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnc2Nyb2xsJyk7CiAgICAgICAgICAgICAgICBtc2cuc2Nyb2xsVG9wID0gbXNnLnNjcm9sbEhlaWdodAogICAgICAgICAgICB9KQogICAgICAgIH0sCiAgICB9Cn0KCg=="},{"version":3,"sources":["GroupChat.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAiCA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"GroupChat.vue","sourceRoot":"src/components","sourcesContent":["<template>\r\n    <div class=\"content\">\r\n        <div class=\"header\">\r\n            <div class=\"backButton\" @click=\"$router.push('/main')\">< Back</div>\r\n            <div class=\"title\">\r\n                <span @click=\"$router.push('/main/groupsetting')\">{{$store.state.queryResult.name}}</span>\r\n            </div>\r\n        </div>\r\n        <div class=\"msg\">\r\n            <div class=\"msgBox\" id=\"scroll\">\r\n                <div class=\"msgRow\" v-for=\"msg in $store.state.recMsg\"\r\n                     v-if=\"msg.groupId === $store.state.queryResult.id\">\r\n                    <span class=\"senderName\">{{msg.name}}</span>\r\n                    <span class=\"receiveTime\">{{msg.time}}</span>\r\n                    <br>\r\n                    <span class=\"msgContent\">{{msg.msg}}</span>\r\n                </div>\r\n            </div>\r\n            <div class=\"inputBox\">\r\n                <div class=\"toolBar\">\r\n                    <span class=\"groupFile\" @click=\"$router.push('/main/groupfile')\">群文件</span>\r\n                    <span class=\"groupFile\" @click=\"$router.push('/main/groupnotice')\">群公告</span>\r\n                </div>\r\n                <textarea class=\"textarea\" v-model=\"chatMsg\" @keyup.enter=\"sendMsg(chatMsg)\"></textarea>\r\n                <div class=\"bottomBar\">\r\n                    <div class=\"sendButton\" @click=\"sendMsg(chatMsg)\">发送</div>\r\n                </div>\r\n            </div>\r\n        </div>\r\n    </div>\r\n</template>\r\n\r\n<script>\r\n    import router from \"../router\";\r\n\r\n    export default {\r\n        name: \"GroupChat\",\r\n        data() {\r\n            return {\r\n                msgUserId: null,\r\n                chatMsg: null,\r\n            }\r\n        },\r\n        mounted() {\r\n            // 初始化websocket\r\n            if (typeof (WebSocket) === \"undefined\") {\r\n                alert(\"您的浏览器不支持WebSocket!\")\r\n            } else {\r\n                this.socket = new WebSocket('ws://127.0.0.1:8088/ws')\r\n                this.socket.onopen = this.open\r\n                this.socket.onerror = this.error\r\n                this.socket.onmessage = this.getMessage\r\n            }\r\n        },\r\n        methods: {\r\n            // 定义websocket基础方法\r\n            open() {\r\n                console.log(\"Socket connected\");\r\n                this.init();\r\n            },\r\n            error() {\r\n                console.log(\"Socket error\")\r\n            },\r\n            send(request) {\r\n                this.socket.send(JSON.stringify(request));\r\n            },\r\n\r\n            getMessage(response) {\r\n                let data = JSON.parse(response.data);\r\n                console.log(data);\r\n                // 聊天消息\r\n                if (data.action === 10) {\r\n                    let date = new Date();\r\n                    data.chatMsg.time = date.toLocaleString('chinese', {hour12: false});\r\n                    this.$store.commit(\"pushRecMsg\", data.chatMsg);\r\n                    if (this.$store.state.queryResult.id !== data.id) {\r\n                        console.log();\r\n                    }\r\n                    this.scroll();\r\n                    this.msgUserId = data.chatMsg.senderId;\r\n                }\r\n                // 好友申请\r\n                if (data.action === 9) {\r\n                    this.msgUserId = 'request'\r\n                }\r\n                // 好友申请通过\r\n                if (data.action === 5) {\r\n                    this.axios.get(\"/user/friend\").then(response => {\r\n                        this.$store.commit('setFriendList', response.data);\r\n                    }).catch((error) => {\r\n                        if (error.response.status === 401) {\r\n                            router.replace(\"/welcome\")\r\n                        }\r\n                    });\r\n                }\r\n            },\r\n            close() {\r\n                console.log(\"Socket closed\")\r\n            },\r\n            // 初始化\r\n            init() {\r\n                let initReq = {\r\n                    \"action\": 1,\r\n                    \"chatMsg\": {\r\n                        \"senderId\": this.$store.state.currentUser.id\r\n                    }\r\n                };\r\n                initReq.chatMsg.senderId = this.$store.state.currentUser.id;\r\n                this.send(initReq)\r\n            },\r\n            // 发送消息\r\n            sendMsg(msg) {\r\n                msg = msg.replace('\\n', '');\r\n                if (!msg) {\r\n                    this.chatMsg = null;\r\n                    alert(\"发送内容不能为空，请重新输入\")\r\n                } else {\r\n                    let chatReq = {\r\n                        action: 10,\r\n                        chatMsg: {\r\n                            senderId: null,\r\n                            groupId: null,\r\n                            name: null,\r\n                            msg: null\r\n                        }\r\n                    };\r\n                    chatReq.chatMsg.senderId = this.$store.state.currentUser.id;\r\n                    chatReq.chatMsg.name = this.$store.state.currentUser.name;\r\n                    chatReq.chatMsg.groupId = this.$store.state.queryResult.id;\r\n                    chatReq.chatMsg.msg = msg.replace('\\n', '');\r\n                    this.send(chatReq);\r\n                    this.chatMsg = null;\r\n                    this.scroll()\r\n                }\r\n            },\r\n            scroll() {\r\n                this.$nextTick(() => {\r\n                    let msg = document.getElementById('scroll');\r\n                    msg.scrollTop = msg.scrollHeight\r\n                })\r\n            },\r\n        }\r\n    }\r\n\r\n</script>\r\n\r\n<style scoped>\r\n    .content {\r\n        padding: 25px;\r\n        height: 100%;\r\n        box-sizing: border-box;\r\n        overflow: hidden;\r\n    }\r\n\r\n    .header {\r\n        position: absolute;\r\n        width: 650px;\r\n        height: 60px;\r\n        border-bottom: 1px solid #CCCCCC;\r\n        text-align: right;\r\n    }\r\n\r\n    .title {\r\n        height: 100%;\r\n        font-size: 24px;\r\n        font-weight: bolder;\r\n        text-align: center;\r\n        line-height: 70px;\r\n    }\r\n\r\n    .title > span {\r\n        cursor: pointer;\r\n    }\r\n\r\n    .backButton {\r\n        position: absolute;\r\n        cursor: pointer;\r\n        font-size: 20px;\r\n        color: #888888;\r\n    }\r\n\r\n    .toolBar {\r\n        width: 100%;\r\n        height: 30px;\r\n        line-height: 30px;\r\n        border-bottom: 1px solid #CCCCCC;\r\n    }\r\n\r\n    .textarea {\r\n        width: 644px;\r\n        height: 80%;\r\n        padding: 5px;\r\n        outline: none;\r\n        resize: none;\r\n        border: none;\r\n        background: #EEEEEE;\r\n        font-size: 20px;\r\n        font-family: Arial, serif;\r\n    }\r\n\r\n    .bottomBar {\r\n        text-align: right;\r\n    }\r\n\r\n    .bottomBar > span {\r\n        color: #888888;\r\n        font-size: 10px;\r\n        margin-right: 20px;\r\n\r\n    }\r\n\r\n    .sendButton {\r\n        display: inline-block;\r\n        border: 1px solid #c1c1c1;\r\n        text-decoration: none;\r\n        background-color: #fff;\r\n        color: #222;\r\n        border-radius: 4px;\r\n        padding: 3px 30px;\r\n        font-size: 14px;\r\n        cursor: pointer;\r\n        user-select: none;\r\n    }\r\n\r\n    .sendButton:hover {\r\n        background-color: #d8d8d8;\r\n    }\r\n\r\n    .senderName {\r\n        margin-right: 20px;\r\n        font-weight: bold;\r\n    }\r\n\r\n    .msgContent {\r\n        word-wrap: normal;\r\n    }\r\n\r\n    .msgRow {\r\n        padding: 5px;\r\n        border-bottom: 1px solid #c1c1c1;\r\n        line-height: 25px;\r\n    }\r\n\r\n    .msgRow:last-child {\r\n        border: none;\r\n    }\r\n\r\n    .receiveTime {\r\n        float: right;\r\n    }\r\n\r\n    .msg {\r\n        height: 100%;\r\n        box-sizing: border-box;\r\n    }\r\n\r\n    .msgBox {\r\n        height: 70%;\r\n        overflow-y: scroll;\r\n        margin-top: 60px;\r\n    }\r\n\r\n    .inputBox {\r\n        width: 650px;\r\n        height: 25%;\r\n        border-top: 1px solid #CCCCCC;\r\n    }\r\n\r\n    .groupFile {\r\n        color: #333333;\r\n        border-left: 1px solid #CCCCCC;\r\n        padding: 0 10px;\r\n        cursor: pointer;\r\n    }\r\n\r\n    .groupFile:last-child {\r\n        border-right: 1px solid #CCCCCC;\r\n    }\r\n\r\n    .latestNotice {\r\n        width: 100%;\r\n        height: 50px;\r\n        line-height: 50px;\r\n        text-align: left;\r\n    }\r\n</style>"]}]}